<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>File Viewer Development Kit: Main TGV Functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="entwrx.css" rel="stylesheet" type="text/css"></head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="sot-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">File Viewer Development Kit
   &#160;<span id="projectnumber">trunk</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Main TGV Functions</div>  </div>
<div class="ingroups"><a class="el" href="group__TgvDeveloping__an__Application.html">Developing an Application</a></div></div><!--header-->
<div class="contents">

<p>Main TGV Functions.
<a href="#details">More...</a></p>
<p>Main TGV Functions. </p>
<p>The functions and groups described below are the most important parts of TGV, but many others are also essential. Please familiarise yourself with the <a class="el" href="group__TgvArchitecture__Overview.html">Architecture Overview</a> and read the detailed API documentation, and follow links given, to explore the whole API.</p>
<h1><a class="anchor" id="Tgv_Stubs_Encoding"></a>
Stub Functions and Encodings</h1>
<p>While all Alien* functions in this SDK must be implemented by the Alien application, it is not always necessary for them to behave correctly, if the Alien application will never use the feature they relate to. In this case, they should be implemented as stubs which return error values. The SecureWrx library provides the Picsel* functions.</p>
<p>All text passed between the SecureWrx library and the Alien application using Picsel's API should be encoded in UTF-8. This allows, for example, the title of the current document (see AlienInformation_TitleInfo) to be specified without doubt or limitation. Text used in the user interface of the application, for example menu options, are not part of this API, and so the can use any localisation system desired by the OEM or user. Similarly, user content, for example actual documents to be viewed, can be loaded by ENTWRX without pre-processing; The SecureWrx library will handle the encoding of content within those files.</p>
<h1><a class="anchor" id="TgvFuncs_Control"></a>
Initialisation and User Control</h1>
<p>This group of functions allow the customer application to start the SecureWrx library and send key events.</p>
<p>PicselApp_start() starts the SecureWrx library. It specifies a particular TGV product, and normally opens a named file to begin with. It must be called once before any other TGV calls are made. When the function returns, it does not confirm successful initialisation; that is notified with AlienInformation_InitComplete. The section <a class="el" href="group__TgvDeveloping__an__Application.html#TgvDeveloping_App_Flow">The Main Flow of Control</a> explains the initialisation process in more detail.</p>
<p>PicselApp_shutDown() closes the SecureWrx library and frees all resources.</p>
<p>PicselApp_keyPress() should be called to indicate that a physical key has been pressed by the user, passing a parameter such as PicselCmdZoomIn. It is also acceptable to send such events to the SecureWrx library when a menu option has been selected, or the application needs to give a command to the SecureWrx library for any reason. This is an example of an upward-facing function for the TGV user interface; the <a class="el" href="group__TgvArchitecture__Overview.html">Architecture Overview</a> explains this further.</p>
<p>PicselApp_keyRelease() is called to indicate a key which was previously pressed, has been released. See also PicselApp_setKeyBehaviour() for configuration; the SecureWrx library can assume releases if they are not notified explicitly, but that degrades the user experience.</p>
<p>PicselApp_loadDocument() loads a new document into File Viewer or Browser, closing the previous one.</p>
<h1><a class="anchor" id="TgvFuncs_Screen"></a>
Screen Display Functions</h1>
<p>These functions control the output from the ENTWRX screen buffer to outside modules.</p>
<p>AlienScreen_update() is the main output from the SecureWrx library. The library provides a buffer containing pixel colour data to be copied to the physical display.</p>
<p>PicselScreen_redraw() requests that the SecureWrx library redraw the current screen. After this, it will call AlienScreen_update().</p>
<p>PicselScreen_resize() resizes the current screen. It helps when adding or removing a status bar from the display, or when connecting to a television or projector. Although the SecureWrx library can display on only one screen at a time, it can be reconfigured in real time. Thus the reSecureWrxution or display mode might be changed when an external device is plugged in or a preference is set.</p>
<p>AlienScreen_getConfiguration() is used by the SecureWrx library to discover the hardware display configuration, to help in filling the display buffer. It is called during initialisation.</p>
<p>PicselScreen_rotate() Rotates the current screen by a multiple of 90 degrees. This is useful when a user wishes to view a landscape format section of a document on a portrait format screen.</p>
<p>PicselApp_hidden() can be used if the device needs to display other information on screen. This might be used when a telephone call is received, or an error message is displayed. AlienScreen_update() will not be called again until after PicselApp_exposed() has been notified.</p>
<h1><a class="anchor" id="TgvFuncs_Config"></a>
Configuration Options</h1>
<p>While most features in the SecureWrx library have default values it is possible to modify these using various configuration options. These allow the SecureWrx library to be optimised for a particular device, particularly regarding timing and response times.</p>
<p>AlienConfig_initialiseAgents() is part of the Alien application, and should be populated with calls to all the available document agents, for example Picsel_Agent_Word(). It is called when the SecureWrx library is started. Document Agents are the components within ENTWRX File Viewer that parse document files, ready for displaying on screen. The actual agent used for each document depends on the filename, MIME type and data content, and will be chosen from those initialised here. The ROM footprint of the linked application will vary, depending on which agents are initialised. Browser (see Browser) follows the same model and relies on Picsel_Agent_Html().</p>
<p>AlienConfig_ready() is called by ENTWRX when the library is ready to receive configuration settings. This should be populated with calls to the configuration settings such as Picsel_Encoding_Register_jajp() and PicselConfig_setInt(). The ROM footprint will be affected by functions such as Picsel_Font_Register_kokr(), which include substantial static data tables.</p>
<p>PicselConfig_setInt() sets a numeric configuration option. It takes an option name such as PicselConfig_maxImageSize. Most options will only be respected if set from within AlienConfig_ready(). PicselConfig_setString() is similar, but sets a textual option, such as PicselConfig_missingImagePlaceholder.</p>
<p>Some features are configured using specific functions, rather than the general purpose interface, for example PicselApp_setKeyBehaviour(). A very few options need to be set early or frequently and have a special API, for example PicselApp_ExpandingHeap and PicselApp_LoadFlags_ForceCache.</p>
<h1><a class="anchor" id="TgvFuncs_Locale"></a>
Fonts, Locales and Character Encodings</h1>
<p>Functions like Picsel_Encoding_Register_zhcn() are used to activate text character encodings required for Japanese, Korean, Simplified Chinese or Traditional Chinese. They should only be called from AlienConfig_ready(). As with the document agents, calling only those which you require for your target market region allows you to reduce the ROM footprint at link time by omitting unnecessary encodings. Other languages not listed in the API reference documentation are always included.</p>
<p>The SecureWrx library will choose an appropriate encoding for each document loaded based upon a number of factors. It is acceptable to call several of these functions. As an example, the encodings Shift_JIS, EUC-JP and ISO-2022-JP are made available by calling Picsel_Encoding_Register_jajp().</p>
<p>PicselLocale_set() sets the language for the device. If it is not called the default will be used, which is usually British English but will depend on the build.</p>
<p>Functions such as Picsel_PdfLanguage_Register_kokr() are used to include data for "CMap" character encodings specific to Adobe PDF documents. The functions should only be called if Picsel_Agent_Pdf() is also called, and only from AlienConfig_ready(). As with the document agent functions above, these allow you to save memory at link time by avoiding calling irrelevant ones. It is acceptable to call several of these functions.</p>
<p>Picsel_Font_Register_zhtw() and similar functions are used to include the font shapes for the required languages. They should be called from AlienConfig_ready(). The actual characters will be used according to the content of each document. As with the document agent functions above, these allow you to save memory at link time by avoiding calling irrelevant ones.</p>
<p>It is normal to call several of these functions, for example Picsel_Font_Register_kokr(), Picsel_Font_Register_jajp(), Picsel_Encoding_Register_kokr(), Picsel_Encoding_Register_jajp(), Picsel_PdfLanguage_Register_kokr(), and Picsel_PdfLanguage_Register_jajp()</p>
<h1><a class="anchor" id="TgvFuncs_Platform"></a>
Platform and Low Level Functions</h1>
<p>As the <a class="el" href="group__TgvArchitecture__Overview.html">Architecture Overview</a> explains, the APIs of TGV include both user-interface and operating-system functions. The SecureWrx library will call those described below, which must be implemented by the Alien application.</p>
<p>AlienMemory_malloc() allocates memory for the SecureWrx library. It is normally called exactly once, and requests a large block (perhaps 10Mb).</p>
<p>AlienFile_open() opens a file by name, so that data from it can be read. It is comparable to <code>fopen()</code> in the C standard library. The syntax of a valid filename does not need to relate directly to the underlying filing system, so long as all parts of the AlienFile* API that ENTWRX uses are consistent. Like all of the TGV functions, the UTF-8 character encoding is used for text.</p>
<p>PicselApp_timerExpiry() allows ENTWRX to yield control before finishing processing a request. It is an important platform function because it allows multi-tasking, even on a single-threaded platform. See <a class="el" href="group__TgvAsync__Queue.html">Asynchronous Events and Threads</a> for more information about the architecture, and <a class="el" href="group__TgvAsync__Queue.html#TgvHost_Thread">Threads Hosting the SecureWrx library</a> for important advice on the context from which this may be called by the Alien application.</p>
<p>AlienEvent_setPicselContext() is called by the SecureWrx library during startup, to define the Picsel_Context pointer which must be passed by the Alien application to all Picsel* functions. The context pointer holds data about the state of the SecureWrx library. It is equivalent to a set of global variables, but is implemented in this way because some platforms cannot store global variables. The Alien application should not read or write the data it points to. An equivalent Alien_Context is defined by the Alien application and passed by ENTWRX to every Alien* function it calls.</p>
<h1><a class="anchor" id="TgvFuncs_Information"></a>
Information and Error Status</h1>
<p>AlienEvent_information() is used when the SecureWrx library wishes to return a value to the application asynchronously, or to inform it of its status. There are many different information data structures that may be provided, for example AlienInformation_DocumentLoadedInfo. See <a class="el" href="group__TgvAsync__Queue.html">Asynchronous Events and Threads</a>.</p>
<p>These events may be ignored if desired, but are often used to set status icons on screen, or to change modes. Examples include notification that the document has been loaded, or that memory limitations have forced the quality to be reduced.</p>
<p>Some information is provided through special functions rather than the standard Information events, for example AlienScreen_pagesChanged().</p>
<p>Errors are notified using AlienError_error(), which is typically minor and can sometimes be ignored, or AlienError_fatal() which is called when the SecureWrx library must close down.</p>
<p>AlienDebug_output() may be called to output Picsel-internal text messages, for example to a serial port or a file that can be read by another computer. It can be ignored, and should have no effect on a production device, but will be useful during development.</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="group__TgvFurther__Information.html">Further Information</a> </dd></dl>
</div><!-- contents -->
<hr size="1"><address style="align: right;"><small>
<img src="securewrx-logo-small.png" align=right>
Copyright &copy; <a href="http://www.entwrx.com/">ENTWRX Ltd</a> 2014.
All rights reserved.
Generated on Thu Jul 2 2015 for File Viewer Development Kit trunk by
<a href="http://www.doxygen.org/">Doxygen</a>.</small></address>
<!-- Footer $Id: doxy-footer.html,v 1.4.10.1 2014/06/06 11:55:46 andrews Exp $ -->
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>File Viewer Development Kit: Downloading to Plug-Ins</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="entwrx.css" rel="stylesheet" type="text/css"></head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="sot-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">File Viewer Development Kit
   &#160;<span id="projectnumber">trunk</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Downloading to Plug-Ins</div>  </div>
</div><!--header-->
<div class="contents">

<p>Downloading of Content from the network to an external player application.
<a href="#details">More...</a></p>
<p>Downloading of Content from the network to an external player application. </p>
<dl class="section user"><dt>Applicable ENTWRX Products:</dt><dd>ENTWRX Browser Development Kit</dd></dl>
<p>Some files available from web sites are not actually web pages, but contain multi-media data which can be interpreted by other applications outside the web browser. ENTWRX Browser provides an API for downloading such files and passing the data to the Alien application, which can then process it as it wishes.</p>
<p><div class="dotgraph">
<img src="dot_download-flow.png" alt="dot_download-flow.png" border="0" usemap="#dot_download-flow.map"/>
<map name="dot_download-flow.map" id="dot_download-flow.map"></map>
</div>
</p>
<p>Before the SecureWrx library begins downloading the body of content, it confirms this with the Alien application in two stages. These are designed to minimise unwanted network traffic, which may be paid for by the end user. The first confirmation is based on information available from the hypertext link being followed. The second uses the HTTP headers received from the server. Content is then streamed progressively as it is received (see also TgvStreamingInput).</p>
<p>ENTWRX BDK already includes an API where it can ask the Alien application if it wishes to permit a hypertext link from one web page to another. This is called a Transition. This is used as normal within the downloading process. Unfortunately due to standard web protocols, the device cannot know the MIME Type of the content at this stage. Therefore ENTWRX expects that PicselUserRequest_Type_Transition will normally be accepted, subject to the existing constraints, and may be cancelled later.</p>
<p>After this, ENTWRX BDK will begin to download the file, and will in due course receive the MIME Type from the server.</p>
<h3>Download Confirmation</h3>
<p>Normally, decisions about the download can only be made after the file has been requested and the MIME Type has been received from the server. At this time, the whole file will continue to be received unless the browser cancels the operation.</p>
<p>Most web pages contain content that ENTWRX BDK can process internally, and these will not usually follow the "Download" procedure. However, even file types which ENTWRX can understand can be downloaded. This is configured with PicselConfigBr_downloadableMimeTypes.</p>
<p>When one of these MIME types begins to arrive in ENTWRX BDK, it will ask the Alien application what to do next using PicselUserRequest_DownloadConfirm. The response from the Alien application can take one of three forms:</p>
<ul>
<li>Download the file and stream it to the Alien application.</li>
<li>Cancel the download.</li>
<li>Download the file and display it in ENTWRX BDK as normal.</li>
</ul>
<p>Although the event is a <code>PicselUserRequest_</code> it is not recommended that the user be prompted interactively, because the file is already being received at this stage (due to the standard nature of HTTP). Normally the Alien application will be pre-configured for the correct behaviour for any given MIME type.</p>
<p><div class="dotgraph">
<img src="dot_download-to-player.png" alt="dot_download-to-player.png" border="0" usemap="#dot_download-to-player.map"/>
<map name="dot_download-to-player.map" id="dot_download-to-player.map"><area shape="rect" href="" coords="240,65,360,78"><area shape="rect" href="" coords="216,102,384,115"><area shape="rect" href="" coords="158,213,443,226"><area shape="rect" href="" coords="222,250,379,263"><area shape="rect" href="" coords="168,348,433,361"></map>
</div>
</p>
<p>As a file is being downloaded for streaming to the Alien application, the data will be delivered by BDK using the message PicselUserRequest_DownloadData. Each message carries a buffer of data, which is the content in the downloaded file. The buffer will be valid only during the request, so the Alien application should copy it to another buffer or application, and then return with PicselUserRequest_Result_Accepted.</p>
<p>If the application decides that it can no longer process the file, it can be cancelled by returning with PicselUserRequest_Result_Accepted and <code>response</code> = PicselUserRequest_DownloadConfirm_CancelDownload in which case the download will be stopped. This may be useful in several scenarios, including when the user clicks on a "Stop" button, or when some data in the file header reveals that a required codec or feature is not available in the client application.</p>
<p>If the download needs to be cancelled from a location other than the UserRequest handlers, the Alien application can call PicselDownload_cancel().</p>
<p>The size of the file downloaded may be large. ENTWRX recommends that the Alien application should not store the whole file in RAM.</p>
<p>Although the event is a PicselUserRequest_ it is not recommended that the user be prompted interactively, because the file is already being received at this stage, and many such messages will be delivered. Normally the Alien application should continue to accept data, responding promptly with PicselUserRequest_Result_Accepted until the file is finished, or an error occurs.</p>
<p>The size of the buffer in each message is not guaranteed, but is most likely to be similar to the size of an IP packet.</p>
<p>When an entire file has been downloaded completely, or when it has been cancelled or an error has occurred, a final PicselUserRequest_DownloadData message will be sent with a conclusive <code>status</code> value like PicselUserRequest_DownloadData_CompletedOk.</p>
<p>The same downloading process can also be used simply for downloading content to the application, for example to save it to a file.</p>
<p><div class="dotgraph">
<img src="dot_download-save.png" alt="dot_download-save.png" border="0" usemap="#dot_download-save.map"/>
<map name="dot_download-save.map" id="dot_download-save.map"><area shape="rect" href="" coords="269,28,331,41"><area shape="rect" href="" coords="236,65,364,78"><area shape="rect" href="" coords="158,176,443,189"><area shape="rect" href="" coords="222,250,379,263"><area shape="rect" href="" coords="255,348,345,361"><area shape="rect" href="" coords="239,422,361,435"><area shape="rect" href="" coords="248,483,352,496"></map>
</div>
</p>
<h3>Cancelling a Download</h3>
<p>If the Alien application does not wish to continue with a download based on the MIME type, it should respond to PicselUserRequest_DownloadConfirm with PicselUserRequest_DownloadConfirm_PicselHandled or PicselUserRequest_DownloadConfirm_CancelDownload.</p>
<p>If the Alien application has begun downloading, and then finds that it can no longer accept the data, it can be cancelled after any block of data is received, by replying to PicselUserRequest_DownloadData with PicselUserRequest_Result_Rejected. This may be useful in several scenarios, including when the user clicks on a "Stop" button, or when some data in the file header reveals that a required codec or feature is not available in the client application.</p>
<p>If the download needs to be cancelled from a location other than the UserRequest handlers, the Alien application can call PicselDownload_cancel().</p>
<h3>Downloadable MIME Types</h3>
<p>The API described above will be followed by ENTWRX BDK only for files with MIME types which have already been configured by the Alien application using PicselConfigBr_downloadableMimeTypes. This should done in the normal way using PicselConfig_setString() when it is initialised. It should be set to a space-separated list of all the MIME types which it can support outside ENTWRX BDK. Even when a MIME type is included on this list, it is not a commitment to stream those files; each such file will be offered using PicselUserRequest_DownloadConfirm. Example MIME types for Windows Media Video are <code>"video/x-ms-wmv video/x-ms-wvx video/x-ms-asf"</code>.</p>
<p>Please note that web servers do not always set the MIME type correctly. Within PicselUserRequest_DownloadConfirm the first 128 bytes of data at the header of the file are present, which can be used to verify the mimetype information is correct. Should the Alien application wishes to inspect the header of all files, please set PicselConfigBr_downloadableMimeTypes to <code>"*"</code>.</p>
<p>Some Windows Media Videos are delivered as a metafile which contains a link to another URL where the actual video can be found. This can be supported in several ways. Typically the metafile is downloading using the API described here, and then the player application makes its own HTTP request for the actual video file. Alternatively, ENTWRX BDK can download both. The Alien application may wish to save the metafile to a file as described above.</p>
<h3>Embedded Objects</h3>
<p>The API defined above includes only files which are downloaded individually, for example from links on web pages. If a video or other embedded object is defined with an <code>&lt;embed&gt;</code> or <code>&lt;object&gt;</code> element, it will not be supported at present.</p>
<h3>Interacting with the User</h3>
<p>While some PicselUserRequest_* messages may be decided by prompting the user, that is not recommended for downloading, because files are already being downloaded when they are sent, and the time spent by the user considering the prompt may affect both network reliability and packet data charges on their account. Therefore it is recommended that PicselUserRequest_DownloadConfirm and PicselUserRequest_DownloadData should be handled non-interactively by the Alien application.</p>
<h3>Speed of Downloading</h3>
<p>The speed at which data arrives is generally dependent on the wireless network connection, and cannot be made to go faster. For real-time media such as videos it may be appropriate to cache some proportion of a file before beginning playback, so that consistent playback becomes more likely.</p>
<p>If the application wishes to slow down data reception, it can delay responses to PicselUserRequest_DownloadData for a few seconds. However, a delay approaching a TCP timeout (perhaps 60 seconds, depending on other machine configurations) may cause the connection to be dropped. Such a delay might be useful when playing a real-time multi-media sequence, and when enough data has been received to fill the cache.</p>
<p>If the Alien application wishes to display a progress indicator while downloading, it should maintain a record of the total file size from PicselUserRequest_DownloadConfirm.contentLength, and add together the accumulated size of data received in PicselUserRequest_DownloadData.bufferLength. Depending on the HTTP server response, the <code>contentLength</code> may not be known.</p>
<h3>Blocking Threads</h3>
<p>It is important for the Alien application to copy data from buffers and return control promptly in this API. Failure to respond quickly will block other messages and activities, and may ultimately cause a download to be cancelled by the server if it does not receive appropriate TCP acknowledgements. See <a class="el" href="group__TgvAsync__Queue.html#TgvHost_Thread">Threads Hosting the SecureWrx library</a>.</p>
<p>The events described in this API will be delivered to the Alien application in the correct order, after the previous one has been completed. </p>
</div><!-- contents -->
<hr size="1"><address style="align: right;"><small>
<img src="securewrx-logo-small.png" align=right>
Copyright &copy; <a href="http://www.entwrx.com/">ENTWRX Ltd</a> 2014.
All rights reserved.
Generated on Thu Jul 2 2015 for File Viewer Development Kit trunk by
<a href="http://www.doxygen.org/">Doxygen</a>.</small></address>
<!-- Footer $Id: doxy-footer.html,v 1.4.10.1 2014/06/06 11:55:46 andrews Exp $ -->
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>File Viewer Development Kit: Asynchronous Events and Threads</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="entwrx.css" rel="stylesheet" type="text/css"></head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="sot-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">File Viewer Development Kit
   &#160;<span id="projectnumber">trunk</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Asynchronous Events and Threads</div>  </div>
</div><!--header-->
<div class="contents">
<p>When the Alien application makes a request or notifies the SecureWrx library of something, a meaningful response is not usually available. This is because it often takes longer to process a request than the SecureWrx library is allowed in one time slice. Instead, ENTWRX adds the event to a queue, and processes it asynchronously during the time slices allowed in PicselApp_timerExpiry(). It sends a reply (if applicable) using an AlienInformation_Event. See <a class="el" href="group__TgvAsync__Queue.html#TgvHost_Thread">Threads Hosting the SecureWrx library</a> for more information about threads. <div class="dotgraph">
<img src="dot_async-queue.png" alt="dot_async-queue.png" border="0" usemap="#dot_async-queue.map"/>
<map name="dot_async-queue.map" id="dot_async-queue.map"><area shape="rect" id="edge9" href="" title="AlienEvent_information()" alt="" coords="145,64,282,77"/></map>
</div>
 Many functions with names beginning Picsel*, for example PicselApp_fitDocument(), return the integer 1 which merely indicates that the event has been added to the queue. The value PicselCommand_Queued is equivalent to the success value 1. Many of these functions will later return an AlienInformation_Event to indicate their final outcome.</p>
<p>If the function returns 0 (or PicselCommand_Failed), it means that the queue is full and the request has been discarded; no action will be taken and no further reply will be sent by the SecureWrx library. This might happen if the SecureWrx library is very busy, or has been suspended using com.entwrx.tgv.lib.app.PicselApp_suspend(). If the queue is full, there will not be an AlienInformation_Event; the action failed.</p>
<p>Processing of requests that are initially accepted may later fail, particularly in low memory cases. In this case, there might not be an AlienInformation_Event even if the request was queued. Therefore it is important that the Alien application should never enter a state where it relies upon receiving such an event.</p>
<p>In a simple alien application, it is normally safe to ignore the return value of such functions, so long as the alien application does not enter a state where it requires a reply.</p>
<h1><a class="anchor" id="TgvHost_Thread"></a>
Threads Hosting the SecureWrx library</h1>
<p>Some alien applications are written to use multiple concurrent threads on the device. In general, this is perfectly convenient. However, some care is required when calling ENTWRX functions.</p>
<p>All of Picsel's substantial work is done in the callback function PicselApp_timerExpiry(). ENTWRX will call AlienTimer_request() with a delay of about 10ms, and the Alien application will then call PicselTimer_expiry(), which will take about 50ms to complete. The function PicselApp_setTimeSlice() controls the durations that ENTWRX will request.</p>
<p>ENTWRX does not expect "Alien" functions to take a long time to complete. The ENTWRX API is designed to allow later notification of completion, for those involving calls to the host operating system which may block. The Alien application may use threads and timers internally, to implement this.</p>
<p>Most processing by the SecureWrx library is not threadsafe (it is not re- entrant), and almost no functions with names beginning Picsel* may be called from multiple threads concurrently. Only PicselApp_yieldNow() is truly threadsafe. They must only be called from the thread of the alien application that hosts the SecureWrx library. That is the one that calls PicselApp_timerExpiry() or any system thread created by ENTWRX using AlienThread_create().</p>
<p>There is no need for the alien application to use threads to help the SecureWrx library. All functions return within a short time slice. The SecureWrx library has its own internal soft-threading system which is almost transparent to the alien application. See AlienMemory_mallocStack() and <a class="el" href="group__TgvAsync__Queue.html">Asynchronous Events and Threads</a> for further discussion.</p>
<p>If the device's operating system supports it, the Alien application may use Alien threads. See AlienThread_create() for part of the API. However, ENTWRX soft threads can be used on all operating systems and are recommended.</p>
<p>There are some stack memory issues with ENTWRX soft threads which affect Alien* functions in the alien application, such as AlienTcp_request(). Please see the integration guide for more details.</p>
<p>When ENTWRX calls "Alien" functions such as AlienTcp_request(), it will be called in the context of a ENTWRX thread. ENTWRX sometimes calls Alien functions with only 4Kb of stack memory available. This may not be enough for some complex operations that need to be carried out by the Alien application. </p>
</div><!-- contents -->
<hr size="1"><address style="align: right;"><small>
<img src="securewrx-logo-small.png" align=right>
Copyright &copy; <a href="http://www.entwrx.com/">ENTWRX Ltd</a> 2014.
All rights reserved.
Generated on Thu Jul 2 2015 for File Viewer Development Kit trunk by
<a href="http://www.doxygen.org/">Doxygen</a>.</small></address>
<!-- Footer $Id: doxy-footer.html,v 1.4.10.1 2014/06/06 11:55:46 andrews Exp $ -->
</body>
</html>
